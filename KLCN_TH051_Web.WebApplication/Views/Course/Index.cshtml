@{
    ViewData["Title"] = "Danh sách khóa học";
}

<div class="container-fluid">
    <div class="row">

        <!-- SIDEBAR BỘ LỌC -->
        <div class="col-md-3 col-lg-2 border-end">
            <h5 class="mt-3">Bộ lọc</h5>

            <!-- Search box -->
            <input id="txtSearch" type="text" class="form-control mb-3" placeholder="Tìm kiếm...">

            <!-- Subject -->
            <h6>Môn học</h6>
            <div id="subject-filters" class="mb-3">
                <div class="text-muted small">Đang tải...</div>
            </div>

            <!-- Sort -->
            <h6>Sắp xếp theo</h6>
            <select id="sortSelect" class="form-select mb-3">
                <option value="priceAsc">Giá tăng dần</option>
                <option value="priceDesc">Giá giảm dần</option>
            </select>

            <button id="btnSearch" class="btn btn-primary w-100">SEARCH</button>
        </div>

        <!-- MAIN CONTENT -->
        <div class="col-md-9 col-lg-10">
            <div id="course-list" class="row row-cols-1 row-cols-md-3 g-4 p-3">
                <div class="col text-center text-muted py-5">Đang tải khóa học...</div>
            </div>

            <!-- Pagination -->
            <div class="d-flex justify-content-center mt-3">
                <nav>
                    <ul id="pagination" class="pagination">
                        <!-- Pagination sẽ được render bằng JS -->
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>

<!-- Load JS của page -->
@section Scripts {
    <script type="module" src="/js/modules/student/course.list.js"></script>
}

@* @{
    // var apiUrl = (ViewData["ApiUrl"]?.ToString() ?? "https://localhost:7134").TrimEnd('/');
    ViewData["Title"] = "Danh sách khóa học";
}

<div class="container-fluid">
    <div class="row">

        <!-- SIDEBAR BỘ LỌC -->
        <div class="col-md-3 col-lg-2 border-end">
            <h5 class="mt-3">Bộ lọc</h5>

            <!-- Search box -->
            <input type="text" class="form-control mb-3" placeholder="Tìm kiếm...">

            <!-- Subject -->
            <h6>Môn học</h6>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb1">
                <label class="form-check-label" for="cb1">Cơ bản</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb2">
                <label class="form-check-label" for="cb2">Lập trình web</label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="cb3">
                <label class="form-check-label" for="cb3">Thiết kế</label>
            </div>
            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="cb4">
                <label class="form-check-label" for="cb4">Mobile</label>
            </div>

            <!-- Sort -->
            <h6>Sắp xếp theo</h6>
            <select class="form-select mb-3">
                <option selected>Giá tăng dần</option>
                <option>Giá giảm dần</option>
                <option>Đánh giá</option>
                <option>Mới nhất</option>
            </select>

            <button class="btn btn-primary w-100">SEARCH</button>
        </div>

        <!-- MAIN CONTENT -->
        <div class="col-md-9 col-lg-10">
            <div class="row row-cols-1 row-cols-md-3 g-4 p-3">

                <!-- CARD ITEM -->
                <div class="col">
                    <div class="card h-100">
                        <img src="https://via.placeholder.com/500x250/6c5ce7/ffffff?text=PHP" class="card-img-top">
                        <div class="card-body">
                            <h5 class="card-title">PHP nâng cao</h5>
                            <p class="card-text">Khóa học nâng cao PHP</p>

                            <div class="mb-2 text-warning">★★★★☆</div>

                            <small class="text-muted">GV: Trịnh Hiếu</small>
                        </div>
                        <div class="card-footer bg-white d-flex justify-content-between">
                            <strong>110,000đ</strong>
                            <button class="btn btn-outline-primary btn-sm">🛒</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Pagination -->
            <div class="d-flex justify-content-center mt-3">
                <nav>
                    <ul class="pagination">
                        <li class="page-item disabled"><a class="page-link">‹</a></li>
                        <li class="page-item active"><a class="page-link">1</a></li>
                        <li class="page-item"><a class="page-link">›</a></li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>

<script>
       const API_URL = "@apiUrl/api/course/approved";

    function getHeaders() {
        const token = localStorage.getItem("authToken");
        if (!token) {
            console.log("Không có token → xem như khách");
            return { "Content-Type": "application/json" };
        }
        return {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
        };
    }

    async function loadApprovedCourses() {
        const container = document.querySelector(".row.row-cols-1");

        // Hiển thị trạng thái loading
        container.innerHTML = `
            <div class="col text-center text-muted py-5">
                Đang tải khóa học...
            </div>
        `;

        try {
            const res = await fetch(API_URL, { headers: getHeaders() });

            if (!res.ok) {
                container.innerHTML = `
                    <div class="col text-center text-danger py-5">
                        Không thể tải danh sách khóa học
                    </div>
                `;
                return;
            }

            const courses = await res.json();

            if (!courses || courses.length === 0) {
                container.innerHTML = `
                    <div class="col text-center text-muted py-5">
                        Chưa có khóa học nào được duyệt
                    </div>
                `;
                return;
            }

            container.innerHTML = "";

            courses.forEach(c => {
                container.innerHTML += `
                    <div class="col">
                        <div class="card h-100 shadow-sm">
                            <img src="${c.thumbnail ?? 'https://placehold.co/500x250'}"
                                 class="card-img-top" alt="${c.name}">

                            <div class="card-body">
                                <h5 class="card-title">${c.name}</h5>
                                <p class="card-text">${c.description ?? 'Không có mô tả'}</p>

                                <div class="mb-2 text-warning">★★★★☆</div>

                                <small class="text-muted">GV: ${c.teacherName ?? 'Chưa cập nhật'}</small>
                            </div>

                            <div class="card-footer bg-white d-flex justify-content-between">
                                <strong>${(c.price ?? 0).toLocaleString('vi-VN')}đ</strong>
                                <button class="btn btn-outline-primary btn-sm">🛒</button>
                            </div>
                        </div>
                    </div>
                `;
            });

        } catch (error) {
            console.error(error);
            container.innerHTML = `
                <div class="col text-center text-danger py-5">
                    Lỗi khi tải dữ liệu
                </div>
            `;
        }
    }

    document.addEventListener("DOMContentLoaded", loadApprovedCourses);
</script> *@
