
@{
    ViewData["Title"] = "Chi tiết khóa học";
    var apiBaseUrl = Context.Request.Scheme + "://" + Context.Request.Host; // tự động lấy domain hiện tại
}
<script>
    window.API_URL = "@apiBaseUrl";
</script>
<link href="~/css/coursedetail.css" rel="stylesheet" />
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <!-- ================== THÔNG TIN KHOÁ HỌC ================== -->
            <div class="d-flex align-items-center justify-content-between mb-4">
                <h4 class="mb-0">Cập nhật khóa học</h4>
                <span id="courseStatus" class="fs-4">Đang tải...</span>
            </div>

            <form id="courseForm">
                <div class="row">
                    <div class="col-md-8 mb-3">
                        <label class="form-label">Tên khóa học</label>
                        <input type="text" class="form-control" id="courseName">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Môn học</label>
                        <select class="form-select" id="courseCategory">
                            <option value="">-- Chọn môn học --</option>
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Hình ảnh khóa học</label>
                    <input type="file" class="form-control" id="courseImage" accept="image/*">
                </div>

                <div class="mb-3">
                    <label class="form-label">Mô tả</label>
                    <textarea class="form-control" id="courseDescription" rows="4"></textarea>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Giá (VNĐ)</label>
                        <input type="number" class="form-control" id="coursePrice">
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ngày bắt đầu</label>
                        <input type="datetime-local" class="form-control" id="startDate">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label">Ngày kết thúc</label>
                        <input type="datetime-local" class="form-control" id="endDate">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary mb-4">
                    <i class="bi bi-save"></i> Lưu thông tin khóa học
                </button>
                <button type="button" id="submitCourseButton" class="btn btn-primary mb-4">
                    <i class="bi bi-send"></i> Gửi khóa học
                </button>
            </form>

            <hr class="my-4" />

            <!-- ================== NỘI DUNG KHOÁ HỌC (CHƯƠNG) ================== -->
            <div>
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Nội dung khóa học</h5>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addChapterModal">
                        <i class="bi bi-plus-lg"></i> Thêm chương
                    </button>
                </div>

                <div id="chapterList">
                    <!-- JS sẽ render các chương ở đây -->

                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================== MODAL THÊM CHƯƠNG ========================== -->
<div class="modal fade" id="addChapterModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm chương mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tên chương</label>
                    <input type="text" id="addChapterName" class="form-control" placeholder="Ví dụ: Chương 1: Giới thiệu">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="addChapter()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Xóa chương-->
<div class="modal fade" id="deleteChapterModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger">Xác nhận xóa chương</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Bạn có chắc chắn muốn <strong>xóa</strong> chương này không?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" id="btnConfirmDeleteChapter" class="btn btn-danger">Xóa</button>
            </div>
        </div>
    </div>
</div>


<!-- ========================== MODAL SỬA CHƯƠNG ========================== -->
<div class="modal fade" id="updateChapterModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Sửa chương</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tên chương</label>
                    <input type="text" id="editChapterName" class="form-control">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="updateChapter()">Lưu</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Thêm bài học -->
<div class="modal fade" id="addLessonModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm bài học mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Tên bài học</label>
                    <input type="text" class="form-control" id="lessonName" placeholder="Nhập tên bài học">
                </div>

                <div class="mb-3">
                    <label class="form-label">Loại bài học</label>
                    <select class="form-select" id="lessonType">
                        <option value="" disabled selected>Chọn loại bài học</option>
                    </select>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="previewCheck">
                    <label class="form-check-label">Bài học miễn phí (Preview)</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" id="saveLessonBtn">
                    Tạo bài học
                </button>
            </div>
        </div>
    </div>
</div>


<!-- MODAL BÀI ĐỌC (dùng chung cho thêm + sửa) -->
<div class="modal fade" id="editReadingModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Tạo bài đọc mới</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Tên bài đọc</label>
                    <input type="text" id="readingTitle" class="form-control form-control-lg" placeholder="Nhập tiêu đề bài học">
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Nội dung bài học</label>
                    <div id="readingEditor" style="height:450px; border: 1px solid #ddd; border-radius: 0.375rem;"></div>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="readingFree">
                    <label class="form-check-label">Bài học này miễn phí (Preview)</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success btn-lg px-4" onclick="saveReading()">
                    <i class="bi bi-check2"></i> Lưu bài học
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ========================== MODAL VIDEO ========================== -->
<div class="modal fade" id="editVideoModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">Thêm bài học Video</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <form id="videoLessonForm">

                    <div class="mb-3">
                        <label class="form-label">Tiêu đề bài học</label>
                        <input id="videoTitle" type="text" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <label class="form-label">File Video</label>
                        <input id="videoUploadInput" type="file" accept="video/*" class="form-control" />
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input id="editVideoFree" type="checkbox" class="form-check-input" />
                            <label for="editVideoFree" class="form-check-label">Cho phép xem trước</label>
                        </div>
                    </div>

                    <video id="videoPreview" class="w-100" controls>
                        <source />
                    </video>

                </form>
            </div>

            <div class="modal-footer">
                <button type="button" id="btnSaveVideoLesson" class="btn btn-primary">Lưu Video</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>

        </div>
    </div>
</div>



<!-- ========================== MODAL QUIZ ========================== -->
<div class="modal fade" id="editQuizModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header">
                <h5 class="modal-title">Chỉnh sửa Quiz</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">

                <!-- QUIZ TITLE -->
                <div class="mb-3">
                    <label class="form-label fw-bold">Tên Quiz</label>
                    <div class="input-group">
                        <input type="text" id="quizTitle" class="form-control" placeholder="Nhập tên quiz...">
                        <button class="btn btn-primary" onclick="renameQuizTitle()">
                            Lưu tên
                        </button>
                    </div>
                </div>

                <!-- DESCRIPTION -->
                <div class="mb-3">
                    <label class="form-label">Mô tả</label>
                    <textarea id="quizDescription" class="form-control" rows="2" placeholder="Mô tả ngắn về bài kiểm tra"></textarea>
                </div>

                <!-- TOOLBAR -->
                <div class="d-flex justify-content-between mb-3">
                    <button class="btn btn-primary" onclick="addQuestion()">
                        <i class="bi bi-plus-lg"></i> Thêm câu hỏi
                    </button>
                    <button class="btn btn-outline-primary">
                        <i class="bi bi-cloud-upload"></i> Import từ Excel
                    </button>
                </div>

                <!-- QUESTION LIST -->
                <div id="quizQuestionList"></div>
            </div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="saveQuiz()">Lưu</button>
            </div>

        </div>
    </div>
</div>

<!-- Modal Xóa Bài Học (dùng chung cho tất cả bài học) -->
<div class="modal fade" id="deleteLessonModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-danger fw-bold">Xác nhận xóa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center py-4">
                <p class="mb-0">Bạn có chắc chắn muốn <strong>xóa bài học</strong> này không?</p>
                <small class="text-muted">Thao tác không thể hoàn tác!</small>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Hủy</button>
                <button type="button" id="btnConfirmDeleteLesson" class="btn btn-danger px-4">Xóa</button>
            </div>
        </div>
    </div>
</div>



<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>


@section Scripts {
    <script type="module" src="~/js/modules/instructor/course/course.update.js"></script>
    <script type="module" src="~/js/modules/instructor/chapter/chapter.loadlist.js"></script>
    <script type="module" src="~/js/modules/instructor/chapter/chapter.insert.js"></script>
    <script type="module" src="~/js/modules/instructor/chapter/chapter.update.js"></script>
    <script type="module" src="~/js/modules/instructor/chapter/chapter.delete.js"></script>


    <script type="module" src="~/js/modules/instructor/lesson/lesson.insert.js"></script>     <!-- TẠO MỚI BÀI HỌC -->
    <script type="module" src="~/js/modules/instructor/lesson/lesson.list.js"></script>        <!-- HIỂN THỊ + SỬA + XÓA -->

    <script type="module" src="~/js/modules/instructor/lesson/lesson.updateContent.js"></script>
    <script type="module" src="~/js/modules/instructor/lesson/lesson.updatevideo.js"></script>


    <script type="module" src="~/js/modules/instructor/quiz/quiz.edit.js"></script>
    @* Nếu sau này cần import Excel thì bỏ comment dòng dưới *@
    @* <script type="module" src="~/js/modules/instructor/quiz/quiz.questions.js"></script> *@
}