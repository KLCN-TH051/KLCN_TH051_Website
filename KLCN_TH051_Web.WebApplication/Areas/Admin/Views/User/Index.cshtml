<!-- Bootstrap CSS + Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<!-- Nút thêm -->
<button id="btnAddUser" class="btn btn-primary mb-3">
    + THÊM NGƯỜI DÙNG
</button>

<!-- TABLE USERS -->
<table class="table table-hover align-middle">
    <thead class="table-primary">
        <tr>
            <th style="width:60px"></th>
            <th>Tên</th>
            <th>Email</th>
            <th style="width:120px" class="text-center">Tuỳ chọn</th>
        </tr>
    </thead>

    <tbody id="userTable">
        <tr>
            <td><img src="https://i.pravatar.cc/50?img=12" class="rounded-circle" width="45"></td>
            <td class="user-name">Hai Nguyen</td>
            <td class="user-email">hai@gmail.com</td>
            <td class="text-center">
                <button class="btn btn-sm btn-outline-dark btn-edit"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-sm btn-outline-danger btn-delete"><i class="bi bi-trash"></i></button>
            </td>
        </tr>

        <tr>
            <td><img src="https://i.pravatar.cc/50?img=32" class="rounded-circle" width="45"></td>
            <td class="user-name">Nguyễn Thị Thanh</td>
            <td class="user-email">thanh@gmail.com</td>
            <td class="text-center">
                <button class="btn btn-sm btn-outline-dark btn-edit"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-sm btn-outline-danger btn-delete"><i class="bi bi-trash"></i></button>
            </td>
        </tr>
    </tbody>
</table>

<!-- PAGINATION -->
<nav class="mt-3">
    <ul class="pagination justify-content-center w-100">
        <li class="page-item disabled">
            <a class="page-link">Prev</a>
        </li>
        <li class="page-item active">
            <a class="page-link">1</a>
        </li>
        <li class="page-item">
            <a class="page-link">2</a>
        </li>
        <li class="page-item">
            <a class="page-link">3</a>
        </li>
        <li class="page-item">
            <a class="page-link">Next</a>
        </li>
    </ul>
</nav>


<!-- MODAL -->
<div class="modal fade" id="userModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Người dùng</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <label class="form-label">Tên</label>
                <input type="text" id="inputName" class="form-control mb-3">

                <label class="form-label">Email</label>
                <input type="text" id="inputEmail" class="form-control">
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">CANCEL</button>
                <button id="btnModalSave" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>
</div>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const userTable = document.getElementById("userTable");
    const userModal = bootstrap.Modal.getOrCreateInstance(document.getElementById("userModal"));

    const btnAddUser = document.getElementById("btnAddUser");
    const btnModalSave = document.getElementById("btnModalSave");

    const inputName = document.getElementById("inputName");
    const inputEmail = document.getElementById("inputEmail");

    let editingRow = null;

    // ==== OPEN MODAL FOR ADD ====
    btnAddUser.addEventListener("click", () => {
        editingRow = null;
        inputName.value = "";
        inputEmail.value = "";
        userModal.show();
    });

    // ==== SAVE (ADD or EDIT) ====
    btnModalSave.addEventListener("click", () => {
        const name = inputName.value.trim();
        const email = inputEmail.value.trim();
        if (!name || !email) return;

        if (editingRow) {
            // UPDATE
            editingRow.querySelector(".user-name").textContent = name;
            editingRow.querySelector(".user-email").textContent = email;
        } else {
            // ADD NEW ROW
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td><img src="https://i.pravatar.cc/50?u=${email}" class="rounded-circle" width="45"></td>
                <td class="user-name">${name}</td>
                <td class="user-email">${email}</td>
                <td class="text-center">
                    <button class="btn btn-sm btn-outline-dark btn-edit"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-outline-danger btn-delete"><i class="bi bi-trash"></i></button>
                </td>
            `;
            userTable.appendChild(tr);
        }

        userModal.hide();
    });

    // ==== EDIT or DELETE ====
    userTable.addEventListener("click", (e) => {

        // DELETE
        if (e.target.closest(".btn-delete")) {
            e.target.closest("tr").remove();
            return;
        }

        // EDIT
        if (e.target.closest(".btn-edit")) {
            editingRow = e.target.closest("tr");

            inputName.value = editingRow.querySelector(".user-name").textContent;
            inputEmail.value = editingRow.querySelector(".user-email").textContent;

            userModal.show();
        }
    });
</script>
